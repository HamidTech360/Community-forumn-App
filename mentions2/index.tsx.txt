import { Mention, MentionsInput } from "react-mentions";
import { defaultStyle, defaultMentionStyle } from "./mentionStyles";
// import { StylesViaJss } from "substyle-jss";

import { provideExampleValue } from "./higher-order";
import { MentionUserApiSearch } from "@/components/Organisms/App/ApiSearch/globalApiSearch";

const fetchMentionUser = async (query, callback) => {
  // Axios fetch users by search
  if (query.length > 0) {
    const searchValue = query.substring(0).toLowerCase();
    const mentionUser = await MentionUserApiSearch(searchValue);

    // Populate Users Been Followed For @Mentions
    const usersList = [];
    await mentionUser?.filter(user => {
      const firstLastName = `${user?.firstName} ${user?.lastName}`;
      firstLastName.toLowerCase().startsWith(searchValue);

      usersList.push({
        display: firstLastName,
        id: firstLastName
        // id: user?._id
      });
    });

    // Users to display
    return callback(usersList);
  }
};

function UserMentions({ value, onChange }) {
  console.log("onChange:", onChange);
  return (
    // <StylesViaJss>
    <div className="async">
      <h3>Async Github user mentions</h3>

      <MentionsInput
        value={value}
        onChange={onChange}
        style={defaultStyle}
        placeholder="Mention any Github user by typing `@` followed by at least one char"
        a11ySuggestionsListLabel={"Suggested Github users for mention"}
      >
        <Mention
          displayTransform={login => `@${login}`}
          trigger="@"
          // data={fetchUsers}
          data={fetchMentionUser}
          style={defaultMentionStyle}
        />
      </MentionsInput>
    </div>
    // </StylesViaJss>
  );
}

const asExample = provideExampleValue("");

export default asExample(UserMentions);
// export default UserMentions;
